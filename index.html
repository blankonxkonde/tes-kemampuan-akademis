<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar File - Tes Kemampuan Akademis</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 8px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        a {
            text-decoration: none;
            color: #007bff;
            font-weight: 500;
        }
        a:hover {
            text-decoration: underline;
            color: #0056b3;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .file-type {
            font-size: 0.8em;
            color: #666;
            margin-left: 10px;
        }

        /* Tree view styles */
        #file-list ul {
            padding-left: 20px;
        }

        #file-list .nested {
            display: none;
        }

        #file-list .active {
            display: block;
        }

        #file-list .folder > .folder-name {
            cursor: pointer;
            font-weight: bold;
            user-select: none; /* Prevent text selection on click */
        }

        #file-list .folder > .folder-name::before {
            content: 'üìÅ '; /* Closed Folder icon */
            display: inline-block;
        }

        #file-list .folder.expanded > .folder-name::before {
            content: 'üìÇ '; /* Open folder icon */
        }

        #content-viewer {
            display: none; /* Sembunyikan secara default */
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        #content-viewer img {
            max-width: 100%;
            height: auto;
        }

        #back-button {
            margin-bottom: 20px;
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #back-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1 id="main-title">Daftar File</h1>
    <ul id="file-list">
        <li class="loading">Memuat daftar file...</li>
    </ul>

    <div id="content-viewer">
        <button id="back-button">‚Üê Kembali ke Daftar File</button>
        <div id="md-content"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // --- KONFIGURASI GITHUB ---
        // Ganti dengan username GitHub Anda
        const GITHUB_USER = 'blankonxkonde'; 
        // Ganti dengan nama repository GitHub Anda
        const GITHUB_REPO = 'tes-kemampuan-akademis'; 
        // Path ke folder ini di dalam repo. Kosongkan jika ada di root.
        const FOLDER_PATH = ''; 
        // -------------------------

        async function getRepoFiles() {
            try {
                // 1. Dapatkan info repo untuk menemukan default branch
                const repoInfoResponse = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}`);
                if (!repoInfoResponse.ok) throw new Error(`Gagal mengambil info repo: ${repoInfoResponse.statusText}`);
                const repoInfo = await repoInfoResponse.json();
                const defaultBranch = repoInfo.default_branch;

                // 2. Dapatkan SHA pohon file dari commit terakhir di default branch
                const branchInfoResponse = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/branches/${defaultBranch}`);
                if (!branchInfoResponse.ok) throw new Error(`Gagal mengambil info branch: ${branchInfoResponse.statusText}`);
                const branchInfo = await branchInfoResponse.json();
                const treeSha = branchInfo.commit.commit.tree.sha;

                // 3. Ambil seluruh pohon file secara rekursif
                const treeResponse = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/git/trees/${treeSha}?recursive=1`);
                if (!treeResponse.ok) throw new Error(`Gagal mengambil pohon file: ${treeResponse.statusText}`);
                const treeData = await treeResponse.json();

                // 4. Filter dan kembalikan hanya path file yang relevan
                const ignoredFiles = ['index.html'];
                return treeData.tree
                    .filter(item => 
                        item.type === 'blob' && 
                        !ignoredFiles.includes(item.path.split('/').pop()) &&
                        (FOLDER_PATH ? item.path.startsWith(FOLDER_PATH + '/') : true)
                    )
                    .map(item => FOLDER_PATH ? item.path.substring(FOLDER_PATH.length + 1) : item.path);
            } catch (error) {
                console.error("Kesalahan saat mengambil file dari GitHub:", error);
                throw error; // Re-throw untuk ditangani oleh pemanggil
            }
        }
        
        function buildFileTree(paths) {
            const tree = {};
            paths.forEach(path => {
                const parts = path.split('/');
                let currentLevel = tree;
                parts.forEach((part, index) => {
                    if (index === parts.length - 1) { // Ini adalah file
                        currentLevel[part] = { __type: 'file', __path: path };
                    } else { // Ini adalah direktori
                        if (!currentLevel[part]) {
                            currentLevel[part] = { __type: 'folder', __children: {} };
                        }
                        currentLevel = currentLevel[part].__children;
                    }
                });
            });
            return tree;
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            switch(ext) {
                case 'html': return 'HTML';
                case 'md': return 'Markdown';
                default: return ext.toUpperCase();
            }
        }

        function formatFileName(filename) {
            // Mengambil bagian nama file saja, tanpa path folder
            const baseName = filename.split('/').pop();
            return baseName
                .replace('.html', '')
                .replace('.md', '')
                .replace(/[-_]/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }

        function renderFileList(tree) {
            const list = document.getElementById('file-list');
            list.innerHTML = '';

            if (Object.keys(tree).length === 0) {
                 list.innerHTML = '<li>Tidak ada file untuk ditampilkan. Pastikan konfigurasi GitHub (username/repo) sudah benar dan repository tidak private.</li>';
                 return;
            }

            function renderLevel(subtree, container) {
                const sortedKeys = Object.keys(subtree).sort((a, b) => {
                    const itemA = subtree[a];
                    const itemB = subtree[b];
                    if (itemA.__type === 'folder' && itemB.__type !== 'folder') return -1;
                    if (itemA.__type !== 'folder' && itemB.__type === 'folder') return 1;
                    return a.localeCompare(b);
                });

                for (const key of sortedKeys) {
                    const item = subtree[key];
                const li = document.createElement('li');

                    if (item.__type === 'folder') {
                        li.classList.add('folder');
                        li.innerHTML = `<span class="folder-name">${key}</span>`;
                        const sublist = document.createElement('ul');
                        sublist.classList.add('nested');
                        li.appendChild(sublist);

                        li.querySelector('.folder-name').addEventListener('click', (e) => {
                            e.currentTarget.parentElement.classList.toggle('expanded');
                            sublist.classList.toggle('active');
                        });
                        
                        renderLevel(item.__children, sublist);
                    } else {
                        li.classList.add('file');
                        const a = document.createElement('a');
                        const span = document.createElement('span');

                        const isMarkdown = item.__path.endsWith('.md');
                        
                        a.href = item.__path;
                        a.textContent = formatFileName(item.__path);
                        
                        if (isMarkdown) {
                            a.addEventListener('click', (e) => {
                                e.preventDefault();
                                showMarkdownContent(item.__path);
                            });
                        }
                
                        span.className = 'file-type';
                        span.textContent = `(${getFileType(item.__path)})`;
                
                        li.appendChild(a);
                        li.appendChild(span);
                    }
                    container.appendChild(li);
                }
            }
            renderLevel(tree, list);
        }

        async function showMarkdownContent(path) {
            const fileList = document.getElementById('file-list');
            const contentViewer = document.getElementById('content-viewer');
            const mdContent = document.getElementById('md-content');
            const mainTitle = document.getElementById('main-title');

            try {
                // URL untuk mengambil konten mentah dari repo GitHub
                const repoRawUrl = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/`;
                const contentUrl = `${repoRawUrl}${path}`;
                const response = await fetch(contentUrl);
                if (!response.ok) throw new Error(`Gagal memuat konten: ${response.statusText}`);
                
                let text = await response.text();

                // Ganti path gambar relatif ke path absolut di repo GitHub
                const fileDirUrl = `${repoRawUrl}${path.substring(0, path.lastIndexOf('/') + 1)}`;
                text = text.replace(/!\[(.*?)\]\((?!https?:\/\/)(.*?)\)/g, (match, alt, src) => {
                    // Buat URL absolut dari path relatif gambar
                    const imageUrl = new URL(src, fileDirUrl).href;
                    return `![${alt}](${imageUrl})`;
                });

                mdContent.innerHTML = marked.parse(text);

                fileList.style.display = 'none';
                contentViewer.style.display = 'block';
                mainTitle.textContent = formatFileName(path);

            } catch (error) {
                console.error("Gagal menampilkan konten Markdown:", error);
                mdContent.innerHTML = `<p>Gagal memuat konten dari file: ${path}.</p>`;
                fileList.style.display = 'none';
                contentViewer.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const fileList = document.getElementById('file-list');
            const contentViewer = document.getElementById('content-viewer');
            const mainTitle = document.getElementById('main-title');

            document.getElementById('back-button').addEventListener('click', () => {
                contentViewer.style.display = 'none';
                fileList.style.display = 'block';
                mainTitle.textContent = 'Daftar File';
            });

            try {
                const files = await getRepoFiles();
                const fileTree = buildFileTree(files);
                renderFileList(fileTree);
            } catch (error) {
                console.error('Gagal memuat daftar file:', error);
                const list = document.getElementById('file-list');
                list.innerHTML = `<li>Gagal memuat daftar file. Cek konsol (F12) untuk detail error.</li>`;
            }
        });
    </script>
    <script src="dark-mode-toggler.js" defer></script>
</body>
</html>